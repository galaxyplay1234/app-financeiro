<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Minhas FinanÃ§as</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="theme-color" content="#1976d2">

<style>
*{box-sizing:border-box;font-family:Arial,sans-serif}
body{
  margin:0;
  background:#f4f6f8;
  overflow-x:hidden;
}


.top-fixed{
  position:sticky;
  top:0;
  z-index:20;
  background:#f4f6f8;
}

/* HEADER */
header{
  background:#1976d2;
  color:#fff;
  padding:12px;
  display:flex;
  flex-direction:column;
  align-items:flex-start;
}

header h2{
  margin:0;
  font-size:18px;
  font-weight:600;
}

.cat-btn{
  background:transparent;
  border:none;
  color:#fff;
  font-size:22px;
  cursor:pointer;
  padding:4px 6px;
}
.cat-btn:active{opacity:.6}

.month-tabs{
  width:100%;
  display:flex;
  justify-content:center;
  align-items:center;
  gap:14px;
  margin-top:6px;
}

.month-btn{
  background:transparent;
  border:none;
  color:#fff;
  font-size:22px;
  cursor:pointer;
  padding:4px 6px;
}

.month-btn:active{opacity:.6}

#monthLabel{
  font-size:14px;
  font-weight:500;
  min-width:140px;
  text-align:center;
}

.cards{
  display:flex;
  gap:10px;
  padding:10px;
}
.card{
  flex:1;background:#fff;padding:12px;border-radius:10px;
  text-align:center;box-shadow:0 2px 6px rgba(0,0,0,.1)
}
.card h4{margin:0;font-size:14px;color:#666}
.card .main{font-size:18px;font-weight:bold;margin-top:6px}
.card .sub{font-size:13px;color:#777}
.saldo{border-top:4px solid #1976d2}
.receita{border-top:4px solid #2e7d32}
.despesa{border-top:4px solid #c62828}

/* LISTA */
.list{padding:10px}
.row{display:flex;gap:8px;margin-bottom:8px;cursor:pointer}
.date-card{
  width:56px;height:64px;background:#fff;border-radius:10px;
  display:flex;align-items:center;justify-content:center;
  font-size:14px;font-weight:bold;color:#888;
  box-shadow:0 1px 4px rgba(0,0,0,.1)
}
.item{
  flex:1;background:#fff;padding:10px;border-radius:10px;
  border-left:5px solid #2196f3;
  box-shadow:0 1px 4px rgba(0,0,0,.1);
  height:64px;display:flex;flex-direction:column;justify-content:center
}
.item-top{display:flex;justify-content:space-between}
.item-name{font-weight:bold;font-size:14px}
.item-value{font-size:16px;font-weight:bold}
.income{color:#2e7d32}
.expense{color:#c62828}
.item-bottom{display:flex;justify-content:space-between;align-items:center}
.item-sub{font-size:12px;color:#666}
.badge{
  padding:2px 8px;font-size:12px;border-radius:12px;
  color:#fff;white-space:nowrap
}
.green{background:#2e7d32}
.red{background:#c62828}

/* FAB */
.fab{
  position:fixed;right:20px;bottom:20px;
  width:56px;height:56px;border-radius:50%;
  font-size:26px;background:#1976d2;color:#fff;border:none
}

/* MODAL */
.modal{
  display:none;
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.5);
  justify-content:center;
  align-items:center;
  z-index:9999; /* ðŸ‘ˆ ESSA LINHA resolve tudo */
}
.modal-content{
  background:#fff;width:90%;max-width:320px;
  padding:16px;border-radius:12px;
  font-size:16px
}

/* TYPE BUTTONS */
.type-buttons{display:flex;gap:8px;margin-bottom:8px}
.type-btn{
  flex:1;padding:10px;border-radius:8px;
  border:1px solid #ccc;background:#f0f0f0;font-weight:bold
}
.type-btn.active.income{background:#2e7d32;color:#fff;border:none}
.type-btn.active.expense{background:#c62828;color:#fff;border:none}

/* INPUTS */
.modal-content input,
.modal-content select,
.modal-content button{
  width:100%;margin-top:8px;padding:10px;
  border-radius:8px;border:1px solid #ccc;
  font-size:16px
}

.modal-content input[type="date"]{
  width:100%;
  box-sizing:border-box;
  -webkit-appearance:none;
  appearance:none;
}

/* SWITCH */
.switch-row{
  display:flex;justify-content:space-between;
  align-items:center;margin-top:10px
}
.switch{position:relative;width:46px;height:26px}
.switch input{display:none}
.slider{
  position:absolute;inset:0;cursor:pointer;
  background:#ccc;border-radius:26px;transition:.3s
}
.slider:before{
  content:"";position:absolute;width:20px;height:20px;
  left:3px;top:3px;background:#fff;border-radius:50%;
  transition:.3s
}
input:checked + .slider{background:#2e7d32}
input:checked + .slider:before{transform:translateX(20px)}

/* BUTTONS */
.modal-content button{background:#1976d2;color:#fff;border:none}
.modal-content button.cancel{background:#9e9e9e}
.modal-content button.delete{background:#c62828}

.category-item{
  display:flex;
  justify-content:space-between;
  align-items:center;
  background:#f4f6f8;
  padding:8px 10px;
  border-radius:8px;
  margin-top:6px;
  font-size:14px;
}

.category-item button{
  background:none;
  border:none;
  color:#c62828;
  font-size:16px;
  font-weight:bold;
  cursor:pointer;

  /* alinhamento perfeito */
  display:flex;
  align-items:center;
  justify-content:center;

  /* Ã¡rea de clique mÃ­nima */
  width:20px;
  height:20px;

  padding:0;
  line-height:1;
}

#categoryModal .modal-content{
  max-height:80vh;
  display:flex;
  flex-direction:column;
}

#categoryList{
  overflow-y:auto;
  max-height:260px;
}

</style>
</head>

<body>

<div class="top-fixed">

  <header>
    <div style="width:100%;display:flex;justify-content:space-between;align-items:center">
  <h2>ðŸ’° Minhas FinanÃ§as</h2>

  <div style="display:flex;gap:10px">
  <button class="cat-btn" onclick="openCategoryModal()">â˜°</button>
  <button class="cat-btn" onclick="goReports()">ðŸ“Š</button>
</div>
</div>
    <div class="month-tabs">
      <button class="month-btn" onclick="changeMonth(-1)">&#10094;</button>
      <span id="monthLabel"></span>
      <button class="month-btn" onclick="changeMonth(1)">&#10095;</button>
    </div>
  </header>

  <section class="cards">
    <div class="card saldo">
      <h4>Saldo</h4>
      <div class="main" id="saldoPago">R$ 0,00</div>
      <div class="sub" id="saldoPrev">R$ 0,00</div>
    </div>

    <div class="card receita">
      <h4>Receitas</h4>
      <div class="main" id="recPago">R$ 0,00</div>
      <div class="sub" id="recPrev">R$ 0,00</div>
    </div>

    <div class="card despesa">
      <h4>Despesas</h4>
      <div class="main" id="despPago">R$ 0,00</div>
      <div class="sub" id="despPrev">R$ 0,00</div>
    </div>
  </section>

</div>

<section class="list" id="list"></section>

<button class="fab" onclick="openModal()">+</button>

<div class="modal" id="modal">
<div class="modal-content">

<div class="type-buttons">
  <button class="type-btn income active" onclick="setType('income')">Receita</button>
  <button class="type-btn expense" onclick="setType('expense')">Despesa</button>
</div>

<input id="title" placeholder="Nome">
<input id="value" placeholder="Valor">
<select id="category">
  <option>Geral</option>
  <option>AlimentaÃ§Ã£o</option>
  <option>Moradia</option>
  <option>Transporte</option>
</select>
<input id="date" type="date">

<div class="switch-row">
  <span>Pago</span>
  <label class="switch">
    <input type="checkbox" id="paid">
    <span class="slider"></span>
  </label>
</div>

<button onclick="save()">Salvar</button>
<button id="deleteBtn" class="delete" onclick="remove()">Excluir</button>
<button class="cancel" onclick="closeModal()">Cancelar</button>

</div>
</div>

<div class="modal" id="categoryModal">
  <div class="modal-content">

    <h3 style="margin:0 0 10px 0">Categorias</h3>

    <input id="categoryName" placeholder="Nome da categoria">

    <button onclick="saveCategory()">Salvar</button>

    <div id="categoryList" style="margin-top:12px"></div>

    <button class="cancel" onclick="closeCategoryModal()">Fechar</button>

  </div>
</div>

<script>
let currentMonth = new Date();
let editIndex = null;
let currentType = "income";

const monthLabel = document.getElementById("monthLabel");
const modal = document.getElementById("modal");
const deleteBtn = document.getElementById("deleteBtn");
const valueInput = document.getElementById("value");

valueInput.addEventListener("input",()=>{
  let v=valueInput.value.replace(/\D/g,"");
  v=(Number(v)/100).toLocaleString("pt-BR",{minimumFractionDigits:2});
  valueInput.value=v;
});

function updateMonthLabel(){
  const meses=["Janeiro","Fevereiro","MarÃ§o","Abril","Maio","Junho","Julho","Agosto","Setembro","Outubro","Novembro","Dezembro"];
  monthLabel.innerText = `${meses[currentMonth.getMonth()]} ${currentMonth.getFullYear()}`;
}

function getMonthKey(){
  return `${currentMonth.getFullYear()}-${String(currentMonth.getMonth()+1).padStart(2,"0")}`;
}

function changeMonth(step){
  currentMonth.setMonth(currentMonth.getMonth()+step);
  updateMonthLabel();
  render();
}

function setType(t){
  currentType=t;
  document.querySelectorAll(".type-btn").forEach(b=>b.classList.remove("active"));
  document.querySelector(`.type-btn.${t}`).classList.add("active");
}

function getData(){return JSON.parse(localStorage.getItem("finance"))||{}}
function saveData(d){localStorage.setItem("finance",JSON.stringify(d))}

function formatDate(d){
  const [y,m,day]=d.split("-");
  return `${day}/${m}`;
}

function render(){
  const m=getMonthKey();
  const data=getData();
  const list=data[m]||[];
  const container=document.getElementById("list");
  container.innerHTML="";

  let rPago=0,rPrev=0,dPago=0,dPrev=0;

  list.sort((a,b)=>new Date(b.date)-new Date(a.date));

  list.forEach(t=>{
  const realIndex = data[m].indexOf(t);

  if(t.type==="income"){
    t.paid ? rPago+=t.value : rPrev+=t.value;
  }else{
    t.paid ? dPago+=t.value : dPrev+=t.value;
  }

  const late = !t.paid && new Date(t.date) < new Date();

  const row = document.createElement("div");
  row.className = "row";
  row.onclick = () => editById(t.id);

  row.innerHTML = `
    <div class="date-card">${formatDate(t.date)}</div>
    <div class="item">
      <div class="item-top">
        <div class="item-name">${t.name}</div>
        <div class="item-value ${t.type}">
          R$ ${t.value.toLocaleString("pt-BR",{minimumFractionDigits:2})}
        </div>
      </div>
      <div class="item-bottom">
        <div class="item-sub">${t.category}</div>
        ${
          t.paid
            ? `<div class="badge green">${t.type==="income"?"Recebido":"Pago"}</div>`
            : late
              ? `<div class="badge red">Atrasado</div>`
              : ""
        }
      </div>
    </div>
  `;
  container.appendChild(row);
});

  recPago.innerText=`R$ ${rPago.toLocaleString("pt-BR",{minimumFractionDigits:2})}`;
  recPrev.innerText=`R$ ${(rPago+rPrev).toLocaleString("pt-BR",{minimumFractionDigits:2})}`;
  despPago.innerText=`R$ ${dPago.toLocaleString("pt-BR",{minimumFractionDigits:2})}`;
  despPrev.innerText=`R$ ${(dPago+dPrev).toLocaleString("pt-BR",{minimumFractionDigits:2})}`;
  saldoPago.innerText=`R$ ${(rPago-dPago).toLocaleString("pt-BR",{minimumFractionDigits:2})}`;
  saldoPrev.innerText=`R$ ${((rPago+rPrev)-(dPago+dPrev)).toLocaleString("pt-BR",{minimumFractionDigits:2})}`;
}

function save(){
  const m=getMonthKey();
  const data=getData();
  if(!data[m])data[m]=[];

  const val=Number(valueInput.value.replace(/\./g,"").replace(",","."));

  const item = {
  id: editIndex !== null ? getData()[m][editIndex].id : Date.now(),
  name: title.value.trim(),
  value: val,
  category: category.value,
  date: date.value,
  type: currentType,
  paid: paid.checked
};

  editIndex!==null?data[m][editIndex]=item:data[m].push(item);
  saveData(data);
  closeModal();
  render();
}

function edit(i){
  const m=getMonthKey();
  const t=getData()[m][i];
  title.value=t.name;
  valueInput.value=t.value.toLocaleString("pt-BR",{minimumFractionDigits:2});
  category.value=t.category;
  date.value=t.date;
  currentType=t.type;
  paid.checked=t.paid;
  setType(currentType);
  editIndex=i;
  deleteBtn.style.display="block";
  openModal();
}

function editById(id){
  const m = getMonthKey();
  const data = getData();

  const index = data[m].findIndex(item => item.id === id);
  if(index === -1) return;

  edit(index);
}

function remove(){
  const m=getMonthKey();
  const data=getData();
  data[m].splice(editIndex,1);
  saveData(data);
  closeModal();
  render();
}

function openModal(){
  modal.style.display="flex";
  if(editIndex===null){
    title.value="";
    valueInput.value="";
    category.value="Geral";
    const hoje=new Date();
    date.value=`${hoje.getFullYear()}-${String(hoje.getMonth()+1).padStart(2,"0")}-${String(hoje.getDate()).padStart(2,"0")}`;
    paid.checked=false;
    setType("income");
    deleteBtn.style.display="none";
  }
}

function closeModal(){
  modal.style.display="none";
  editIndex=null;
}

function getCategories(){
  return JSON.parse(localStorage.getItem("categories")) || [];
}

function saveCategories(list){
  localStorage.setItem("categories", JSON.stringify(list));
}

function openCategoryModal(){
  document.getElementById("categoryModal").style.display="flex";
  renderCategories();
}

function closeCategoryModal(){
  document.getElementById("categoryModal").style.display="none";
}

function saveCategory(){
  const input=document.getElementById("categoryName");
  const name=input.value.trim();
  if(!name) return;

  const list=getCategories();
  if(list.includes(name)) return;

  list.push(name);
  saveCategories(list);
  input.value="";
  renderCategories();
  updateCategorySelect();
}

function deleteCategory(name){
  let list=getCategories().filter(c=>c!==name);
  saveCategories(list);
  renderCategories();
  updateCategorySelect();
}

function renderCategories(){
  const container=document.getElementById("categoryList");
  container.innerHTML="";
  getCategories()
  .sort((a,b)=>a.localeCompare(b,'pt-BR'))
  .forEach(c=>{
    const div=document.createElement("div");
    div.className="category-item";
    div.innerHTML=`<span>${c}</span><button onclick="deleteCategory('${c}')">âœ•</button>`;
    container.appendChild(div);
  });
}


function updateCategorySelect(){
  const select = document.getElementById("category");
  const categorias = getCategories();

  const valorAtual = select.value;

  select.innerHTML = "";

  categorias.forEach(c=>{
    const opt = document.createElement("option");
    opt.value = c;
    opt.innerText = c;
    select.appendChild(opt);
  });

  if(categorias.includes(valorAtual)){
    select.value = valorAtual;
  }
}


function goReports(){
  window.location.href = "relatorios.html";
}

updateMonthLabel();
render();
updateCategorySelect();

</script>

<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

<script>
  firebase.initializeApp(firebaseConfig);
  const db = firebase.database();
</script>


</body>
</html>