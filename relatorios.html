<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>RelatÃ³rios</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="theme-color" content="#1976d2">

<style>
*{box-sizing:border-box;font-family:Arial,sans-serif}
body{
  margin:0;
  background:#f4f6f8;
  overflow-x:hidden;
}

/* TOPO FIXO */
.top-fixed{
  position:sticky;
  top:0;
  z-index:20;
  background:#f4f6f8;
}

/* HEADER */
header{
  background:#1976d2;
  color:#fff;
  padding:12px;
  display:flex;
  flex-direction:column;
}

.header-row{
  display:flex;
  justify-content:space-between;
  align-items:center;
}

header h2{
  margin:0;
  font-size:18px;
  font-weight:600;
}

.header-actions{
  display:flex;
  gap:10px;
}

.icon-btn{
  background:transparent;
  border:none;
  color:#fff;
  font-size:22px;
  cursor:pointer;
}
.icon-btn:active{opacity:.6}

/* MONTH TABS */
.month-tabs{
  width:100%;
  display:flex;
  justify-content:center;
  align-items:center;
  gap:14px;
  margin-top:6px;
}

.month-btn{
  background:transparent;
  border:none;
  color:#fff;
  font-size:22px;
  cursor:pointer;
}
.month-btn:active{opacity:.6}

#monthLabel{
  font-size:14px;
  font-weight:500;
  min-width:140px;
  text-align:center;
}

/* LISTA */
.list{padding:10px}

/* CARD CATEGORIA */
.report-card{
  background:#fff;
  border-radius:10px;
  padding:12px;
  margin-bottom:10px;
  box-shadow:0 2px 6px rgba(0,0,0,.1);
  cursor:pointer;
}

.report-top{
  display:flex;
  justify-content:space-between;
  align-items:flex-start;
}

.report-name{
  font-weight:bold;
  font-size:15px;
}

.report-values{
  text-align:right;
}

.report-total{
  font-size:16px;
  font-weight:bold;
  color:#000;
}

.report-percent{
  font-size:12px;
  color:#666;
}

/* DETALHES */
.details{
  margin-top:10px;
  border-top:1px solid #eee;
  padding-top:8px;
  display:none;
}

.detail-item{
  display:flex;
  justify-content:space-between;
  margin-bottom:6px;
}

.detail-left{
  font-size:13px;
}

.detail-date{
  font-size:12px;
  color:#777;
}

.detail-value{
  font-size:13px;
  color:#c62828;
}
</style>
</head>

<body>

<div class="top-fixed">
  <header>
    <div class="header-row">
      <h2>ðŸ“Š RelatÃ³rios</h2>
      <div class="header-actions">
        <button class="icon-btn" onclick="window.location.href='index.html'">ðŸ’°</button>
      </div>
    </div>

    <div class="month-tabs">
      <button class="month-btn" onclick="changeMonth(-1)">&#10094;</button>
      <span id="monthLabel"></span>
      <button class="month-btn" onclick="changeMonth(1)">&#10095;</button>
    </div>
  </header>
</div>

<section class="list" id="list"></section>

<script>
let currentMonth = new Date();
let openIndex = null;

const monthLabel = document.getElementById("monthLabel");

function updateMonthLabel(){
  const meses=["Janeiro","Fevereiro","MarÃ§o","Abril","Maio","Junho","Julho","Agosto","Setembro","Outubro","Novembro","Dezembro"];
  monthLabel.innerText = `${meses[currentMonth.getMonth()]} ${currentMonth.getFullYear()}`;
}

function getMonthKey(){
  return `${currentMonth.getFullYear()}-${String(currentMonth.getMonth()+1).padStart(2,"0")}`;
}

function changeMonth(step){
  currentMonth.setMonth(currentMonth.getMonth()+step);
  openIndex = null;
  updateMonthLabel();
  render();
}

function getData(){
  return JSON.parse(localStorage.getItem("finance")) || {};
}

function formatDate(d){
  const [y,m,day]=d.split("-");
  return `${day}/${m}`;
}

function render(){
  const container=document.getElementById("list");
  container.innerHTML="";

  const data=getData();
  const m=getMonthKey();
  const list=data[m] || [];

  const despesas=list.filter(i=>i.type==="expense");

  if(despesas.length===0){
    container.innerHTML="<p style='text-align:center;color:#666'>Sem despesas neste mÃªs</p>";
    return;
  }

  const totalGeral=despesas.reduce((s,i)=>s+i.value,0);

  const grouped={};
  despesas.forEach(i=>{
    if(!grouped[i.category]) grouped[i.category]=[];
    grouped[i.category].push(i);
  });

  const categorias=Object.keys(grouped).map(cat=>{
    const total=grouped[cat].reduce((s,i)=>s+i.value,0);
    return {
      name:cat,
      total,
      percent:Math.round((total/totalGeral)*100),
      items:grouped[cat]
    };
  });

  categorias
    .sort((a,b)=>b.percent-a.percent)
    .forEach((cat,idx)=>{
      const card=document.createElement("div");
      card.className="report-card";

      card.innerHTML=`
        <div class="report-top">
          <div class="report-name">${cat.name}</div>
          <div class="report-values">
            <div class="report-total">R$ ${cat.total.toLocaleString("pt-BR",{minimumFractionDigits:2})}</div>
            <div class="report-percent">${cat.percent}%</div>
          </div>
        </div>

        <div class="details" ${openIndex===idx?"style='display:block'":""}>
          ${cat.items.map(i=>`
            <div class="detail-item">
              <div>
                <div class="detail-left">${i.name}</div>
                <div class="detail-date">${formatDate(i.date)}</div>
              </div>
              <div class="detail-value">R$ -${i.value.toLocaleString("pt-BR",{minimumFractionDigits:2})}</div>
            </div>
          `).join("")}
        </div>
      `;

      card.onclick=()=>{
        openIndex = openIndex===idx ? null : idx;
        render();
      };

      container.appendChild(card);
    });
}

updateMonthLabel();
render();
</script>

</body>
</html>